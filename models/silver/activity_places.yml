version: 2

models:
  - name: activity_places
    description: >
      SILVER cleaned OSM buildings_activity to "places".
      Dedup grain: (region_code, region, feature_id).
      Geometry: geom (SRID=4326) + geom_wkt_4326 (mandatory debug).
      No H3 here by design (H3 is computed in GOLD).

    tests:
      - rowcount_gt_0:
          config:
            name: activity_places__rowcount_gt_0
      - not_empty:
          config:
            name: activity_places__not_empty
      - osm_id_or_way_id_present:
          config:
            name: activity_places__osm_id_or_way_id_present
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [region_code, region, feature_id]
          config:
            name: activity_places__uk_region_region_feature

    columns:
      - name: region_code
        tests: [not_null]
      - name: region
        tests: [not_null]
      - name: feature_id
        tests: [not_null]

      - name: activity_class
        tests:
          - not_null
          - values_in_or_null:
              arguments:
                column_name: activity_class
                values: ["amenity","shop","office","tourism","leisure","sport","craft","building"]
              config:
                name: activity_places__activity_class_allowlist

      - name: activity_type_lc
        tests: [not_null]

      - name: building_levels
        tests:
          - non_negative:
              arguments:
                column_name: building_levels
              config:
                name: activity_places__building_levels_non_negative

      - name: geom_wkt_4326
        tests:
          - not_null
          - wkt_not_empty:
              arguments:
                column_name: geom_wkt_4326
              config:
                name: activity_places__geom_wkt_not_empty
          - wkt_prefix_any:
              arguments:
                column_name: geom_wkt_4326
                prefixes: ["POLYGON", "MULTIPOLYGON", "POINT", "LINESTRING"]
              config:
                name: activity_places__geom_wkt_prefix_any_geo

      - name: source_file
        tests: [not_null]
      - name: load_ts
        tests: [not_null]