version: 2

models:
  - name: feat_h3_buildings_r10
    tests:
      - rowcount_gt_0
      - not_empty
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [region_code, region, h3_r10]

    columns:
      - name: region_code
        tests: [not_null]
      - name: region
        tests: [not_null]
      - name: h3_r10
        tests:
          - not_null
          - is_h3_hex:
              arguments:
                column_name: h3_r10

      - name: cell_wkt_4326
        tests:
          - not_null
          - wkt_not_empty:
              arguments:
                column_name: cell_wkt_4326
          - wkt_prefix_any:
              arguments:
                column_name: cell_wkt_4326
                prefixes: ["POLYGON", "MULTIPOLYGON"]

      - name: cell_center_wkt_4326
        tests:
          - not_null
          - wkt_not_empty:
              arguments:
                column_name: cell_center_wkt_4326
          - wkt_prefix_any:
              arguments:
                column_name: cell_center_wkt_4326
                prefixes: ["POINT"]

      - name: cell_area_m2
        tests:
          - not_null
          - non_negative:
              arguments:
                column_name: cell_area_m2

      - name: buildings_cnt
        tests:
          - not_null
          - non_negative:
              arguments:
                column_name: buildings_cnt

      - name: footprint_area_m2_sum
        tests:
          - non_negative:
              arguments:
                column_name: footprint_area_m2_sum

      - name: built_up_share
        tests:
          - non_negative:
              arguments:
                column_name: built_up_share
          - num_between_or_null:
              arguments:
                column_name: built_up_share
                min_value: 0
                max_value: 1
              config:
                severity: warn

      - name: building_method
        tests:
          - values_in_or_null:
              arguments:
                column_name: building_method
                values: ["activity_places_polygon_centroid"]